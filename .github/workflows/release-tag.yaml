name: Create Folder-Specific Releases

on:
  workflow_dispatch:
    inputs:
      target_folder:
        description: "Folder to release (rust or go)"
        required: true
      version:
        description: "Version for the release (e.g., 0.0.1)"
        required: true

jobs:
  create-release:
    runs-on: ubuntu-latest

    steps:
      # Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v3

      # Ensure the specified folder exists
      - name: Validate folder
        id: validate_folder
        run: |
          if [ ! -d "${{ github.event.inputs.target_folder }}" ]; then
            echo "Folder '${{ github.event.inputs.target_folder }}' does not exist."
            exit 1
          fi

      # Prepare release assets (zip the folder contents)
      - name: Prepare release assets
        run: |
          zip -r "${{ github.event.inputs.target_folder }}.zip" "${{ github.event.inputs.target_folder }}"

      # Create or update the release
      - name: Create GitHub Release
        uses: actions/create-release@v1
        with:
          tag_name: ${{ github.event.inputs.target_folder }}-${{ github.event.inputs.version }}
          release_name: ${{ github.event.inputs.target_folder }}-${{ github.event.inputs.version }}
          body: "Release for ${{ github.event.inputs.target_folder }} version ${{ github.event.inputs.version }}"
          draft: false
          prerelease: false
          files: ${{ github.event.inputs.target_folder }}.zip

      # Clean up generated files
      - name: Cleanup
        run: |
          rm -f "${{ github.event.inputs.target_folder }}.zip"
